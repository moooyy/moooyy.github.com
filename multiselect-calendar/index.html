<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>基于jqueryui的日历多选控件</title>
    <link href="./jqueryui/jquery-ui-1.10.3.custom.min.css" type="text/css" rel="stylesheet" />
</head>
<body role="document">
    <div id="datepicker" class="datepicker"></div>
    <h3>已选日期:</h3>
    <div id="result"></div>
               
<!-- 公共库 -->
<script type="text/javascript" src="./jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="./jqueryui/jquery-ui-1.10.3.custom.min.js"></script>

<script type="text/javascript">
    window.shiftKey = false;
    $("#datepicker").data("multidate",[]);
    $("#datepicker").datepicker({
        numberOfMonths : 3,
        stepMonths: 3,
        dateFormat: "yy-mm-dd",
        onSelect: function (date, picker){
            var selectDate = $("#datepicker").data("multidate") || [];
            for(var i = 0, il = selectDate.length; i < il; i++) {
                if(selectDate[i] == date){
                    selectDate.splice(i,1);
                    $("#result").html(selectDate.join("<br/>"));
                    $("#datepicker").data("multidate", selectDate);
                    return false;
                }
            }
            selectDate.push(date);
            if(shiftKey){
                var range = calRange(date, $("#datepicker").data("begin"));
                // console.log(range);
                selectDate = selectDate.concat(range);
            }else{
                $("#datepicker").data("begin", date);
            }
            // $("#datepicker").data("lastpick", date);
            // console.log(selectDate);
            selectDate = selectDate.unique();
            // console.log(selectDate);
            $("#result").html(selectDate.join("<br/>"));
            $("#datepicker").data("multidate", selectDate);
        },
        beforeShowDay : function (a) {
            var selectDate = $("#datepicker").data("multidate") || [];
            for(var i = 0, il = selectDate.length; i < il; i++) {
                if(new Date(selectDate[i]).setHours(0) == +a){
                    return [true,"ui-datepicker-multiselect"]        
                }
            }
            return [true,"ui-datepicker-unselect"];
        }
    });
    function calRange(date1, date2){
        var D1 = +new Date(date1),
            D2 = +new Date(date2),
            end = Math.max(D1, D2),
            begin = Math.min(D1, D2),
            dates = [];
        for(var i = begin+24*60*60*1000; i < end; i=i+24*60*60*1000){
            dates.push(formatDate(i));
        }
        return dates;
    }
    function formatDate(ms){
        var date = new Date(ms);
        var month = (date.getMonth() + 1) < 10 ? "0" + (date.getMonth() + 1) : (date.getMonth() + 1);
        return date.getFullYear() + "-" + month + "-" + date.getDate();
    }
    function refresh () {
        $("#datepicker").datepicker("refresh");
        $("#result").html($("#datepicker").data("multidate").join("<br/>"));
    };
    Array.prototype.unique = function()
    {
        var n = {},r=[]; //n为hash表，r为临时数组
        for(var i = 0; i < this.length; i++) //遍历当前数组
        {
            if (!n[this[i]]) //如果hash表中没有当前项
            {
                n[this[i]] = true; //存入hash表
                r.push(this[i]); //把当前数组的当前项push到临时数组里面
            }
        }
        return r;
    };
    (function shift() {
        $("body").on("keyup", function (event) {
            if(event.keyCode === 16){
                window.shiftKey = false;
                $("#datepicker").data("begin", null);
            }
        });
        $("body").on("keydown", function (event) {
            // console.log(event.keyCode);
            if(event.keyCode === 16){
                window.shiftKey = true;
            }
        });

    })();
    refresh();
</script>
</body>
</html>